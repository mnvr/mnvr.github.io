<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="utf-8">
<meta name="viewport" content="width=device-width">
<title>fm1-min | mnvr.in</title>
<style>
:root { color-scheme: light dark }
</style>

<script type="module">
let audioContext;
const go = () => {
  if (audioContext) return;

  audioContext = new AudioContext();
  const osc = new OscillatorNode(audioContext);
  const amp = new GainNode(audioContext, { gain: 0 });
  osc.connect(amp)
  osc.start();

  const mix = new GainNode(audioContext, { gain: 0.1 });
  amp.connect(mix).connect(audioContext.destination);

  audioContext.resume();

  const tickTime = 0.425;
  let tick = -1;
  const loop = () => {
    const t = audioContext.currentTime;
    requestAnimationFrame(loop);

    const thisTick = Math.floor(t / tickTime);
    if (thisTick == tick) return;
    tick = thisTick;

    amp.gain.setTargetAtTime(1, t + 0.001, 0.001);
    amp.gain.setTargetAtTime(0, t + 0.002, tickTime / 5);
    amp.gain.setValueAtTime(0, t + tickTime / 2);
  };

  requestAnimationFrame(loop);
}

document.querySelector("button").addEventListener("click", go);
</script>

</head>
<body><button>Play</button></body>
</html>
